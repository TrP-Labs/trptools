<!DOCTYPE html>

<html>

<head>
    <title>TrP Tools Profile</title>
    <meta content='<%- username %>' property="og:title" />
    <meta content="Check out <%- username %>'s profile and many more on trptools.com." property="og:description" />
    <meta name="og:image" itemprop="image" content='<%- imageUrl %>'>

    <link rel="stylesheet" type="text/css" href="/public/stylesheets/style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="icon" type="image/png" href="/public/favicon.ico">

    <style>
        a {
            color: rgb(170, 174, 224);
            text-decoration: none;
        }

        .centerdiv {
            display: block;
            margin: auto;
            margin-bottom: 25px;
            margin-top: 25px;
            /*text-align: center;*/
            width: 80%;
            height: auto;
            background-color: #3a3a3a;
            color: white;
            padding: 15px;
            border-radius: 30px;
            position: relative;
        }

        pre {
            position: relative;
            margin: 5px 0;
            white-space: pre-wrap;
        }

        pre button {
            position: absolute;
            right: 0px;
            border: none;
            opacity: 75%;
        }

        code {
            background-color: rgb(202, 202, 202);
            padding: 5px;
        }

        pre code {
            display: block;
            width: 100%;
            box-sizing: border-box;
            overflow: hidden;
            word-wrap: break-word;
            word-break: break-all;
            height: auto;
        }

        img {
            width: 100%;
            height: auto;
            border-radius: 15px;
            padding-bottom: 5px;
        }

        .profilepicture {
            width: 25px;
            height: auto;
            border-radius: 100%;
            padding-bottom: 0px;
        }

        hr {
            border: 0px;
            border-top: 3px solid #bbb;
        }

        h1, h2, h3 {
            display: inline-block;
            margin-top: 10px;
            margin-bottom: 10px;
            max-width: 70%;
            word-wrap: break-word;
        }

        
        h1:target, h2:target, h3:target {
            background-color: rgba(255, 255, 0, 0.308);
            border-radius: 10px;
            padding: 5px;
            transition-duration: 1s;
        }

        .linkanchor {
            padding-left: 10px;
            cursor: pointer;
            display: inline-block;
            user-select: none;
            transition-duration: 100ms;
        }

        .linkanchor:hover {
            color: rgb(144, 145, 179);
        }

        .linkanchor:active {
            transform: scale(0.8);
        }

        .adminActions {
            position: absolute;
            right: 0px;
        }

        .tag {
            background-color: #585858;
            border-radius: 25px;
            padding: 10px;
            margin-right: 5px;
        }

        .routeicon {
            border-radius: 100%;
            background-color: white;
            text-decoration: none;
            cursor: pointer;
            color: black;
            padding: 15px;
            border: 10px solid;
            text-align: center;
            font-size: 3em;
            font-weight: bold;
            margin-right: 25px;
        }

        .frontbox {
            background-color: #4b4b4b;
            max-width: none;
            word-wrap: normal;
            margin-right: 10px;
        }

        .frontbox h1 {
            max-width: none;
        }
    </style>

    <script src="/public/scripts/universalUtils.js"></script>
</head>

<body>
    <div class="topnavholder">
        <div class="topnav">
            <a href="/">Tools</a>
            <a class="active" href="/articles/about">About</a>
            <a href="https://github.com/Ticko-Grey/trptools">Open Source</a>
        </div>

        <div class="topnav nav-right">
            <a id="loginAccount" href="/auth/login">Login</a>
        </div>
    </div>

    <div class="centerdiv">
        <div style="display: flex; align-items: center;">
            <img style="width: 250px; height: auto; background-color: rgb(77, 77, 77); border-radius: 100%; padding: 0px;" src="<%- imageUrl %>">
            <h1 style="display: inline; font-size: 50px; padding-left: 25px;"><%-username%></h1>

            <div style="margin-left: auto; display: flex; flex-direction: column;">
                <button class="inputbutton" style="background-color: #4b4b4b; width: 200px;" onclick="viewOnRoblox()">View on roblox</button>
                <button id="edit" class="inputbutton" style="display: none; background-color: #4b4b4b; width: 200px;" onclick="editProfile()">Edit</button>
            </div>
        </div>
    </div>

    <div class="centerdiv" id="routedisplay" style="display: none;">
        <h1> Favorite Routes</h1>
        <div style="display: flex; flex-wrap: wrap; width: 100%;">
            <a href="https://trptools.com/articles/Route16" class="routeicon" style="border-color: rgb(141, 45, 45); display: none;" id="Route_16">16</a>
            <a href="https://trptools.com/articles/Route14" class="routeicon" style="border-color: rgb(45, 45, 141); display: none;" id="Route_14">14</a>
            <a href="https://trptools.com/articles/Route10" class="routeicon" style="border-color: rgb(141, 135, 45); display: none;" id="Route_10">10</a>
            <a href="https://trptools.com/articles/Route9" class="routeicon" style="border-color: rgb(45, 141, 66); display: none;" id="Route_9">09</a>
            <a href="https://trptools.com/articles/Route6" class="routeicon" style="border-color: rgb(83, 58, 20); display: none;" id="Route_6">06</a>
        </div>
    </div>

    <div class="centerdiv" id="articledisplay" style="display: none;">
        <h1> Articles</h1>
        <div style="display: flex; flex-direction: row; overflow-x: scroll; width: 100%;" id="bottomboxholder">

        </div>
    </div>
</body>

<script>
    const ownsPage = <%- ownsPage %>
    const id = "<%- userId %>"

    if (ownsPage == true) {
        document.getElementById('edit').style.display = 'block'
    }

    // Load articles
        const urlParams = new URLSearchParams(window.location.search);
        const url = '/articles/get?user=' + id;

        fetch(url).then(response => {
            return response.json()
        }).then(json => {
            if (json.length >= 1) {
                document.getElementById('articledisplay').style.display = "block"
                json.forEach(async mdbdocument => {
                    let name = await fetch('/proxy/name?id=' + mdbdocument.owner)
                    name = await name.json()

                    let data
                    if (mdbdocument.previewImage) {
                        data = `
                            <a href="/articles/${mdbdocument.id}" style="order: 0; flex-shrink: 0;"">
                                <div class="frontbox" style="display: flex; flex-direction: row;">
                                    <div style="display: flex; flex-direction: column;">
                                        <h1 style="color: white; max-width: 350px; word-wrap: break-word;">${mdbdocument.title}</h1>
                                        <p style="color: white;">By ${name.data}</p>
                                    </div>
                                    <img src="${mdbdocument.previewImage}" style="border-radius: 30px; width: 100px; height: 100px; margin-left: 10px;">
                                </div>
                            </a>
                        `

                        console.log(data)
                        const holder = document.getElementById('bottomboxholder')
                        holder.innerHTML += data
                    } else {
                        data = `
                            <a href="/articles/${mdbdocument.id}" style="order: 1; flex-shrink: 0;">
                                <div class="frontbox">
                                    <h1 style="color: white;">${mdbdocument.title}</h1>
                                    <p style="color: white;">By ${name.data}</p>
                                </div>
                            </a>
                        `
                        const holder = document.getElementById('bottomboxholder')
                        holder.innerHTML += data
                    }
                })
            }
        }).catch(err => {
            console.log("One or more articles private or unavailable")
        })

        fetch('/profiles/info/' + id).then(async response => {
            let profileInfo = await response.json()
            if (profileInfo.routes.length >= 1) {
                document.getElementById('routedisplay').style.display = "block"
                profileInfo.routes.forEach(async route => {
                    const routeobj = document.getElementById('Route_' + route)
                    if (routeobj) {
                        routeobj.style.display = "block"
                    }
                })
            }
        }).catch(err => {
            console.log("Routes private or unavailable")
        })

        function editProfile() {
            window.location.href = '/profiles/edit'
        }

        function viewOnRoblox() {
            window.open('https://www.roblox.com/users/' + id + '/profile').focus()
        }
</script>

</html>