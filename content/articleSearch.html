<!DOCTYPE html>

<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel="stylesheet" type="text/css" href="/public/stylesheets/style.css">
        <link rel="icon" type="image/png" href="/public/favicon.ico">

        <title>TrP Tools - Docs</title>
        <meta property="og:type" content="website">
        <meta property="og:title" content="TrP Tools - Docs"/>
        <meta property="og:description" content="TrP Tools is an open source web service which aims to provide easy to use tools to the TrP community"/>
        <meta property="og:url" content="https://trptools.tickogrey.com"/>
        <meta property="og:image" content="/public/icon.png"/>

        <script src="/public/scripts/universalUtils.js"></script>    
        
        <script>
            document.addEventListener('DOMContentLoaded', function () {

                const urlParams = new URLSearchParams(window.location.search);
                const url = '/articles/get?' + urlParams.toString();

                async function loadArticle(mdbocument){
                    if (mdbdocument.owner == "TrP Tools Staff") {
                            var name = {
                                data : "TrP Tools Staff"
                            }
                        } else {
                            var name = await fetch('/proxy/name?id=' + mdbdocument.owner)
                            name = await name.json()
                            console.log(name)
                        }

                        let data 
                        if (mdbdocument.previewImage) {
                            data = `
                                <a href="/articles/${mdbdocument.id}" style="order: 0;"">
                                    <div class="frontbox">
                                        <img src="${mdbdocument.previewImage}" height="225" width="350" style="border-radius: 30px;">
                                        <h1 style="color: white; max-width: 350px; word-wrap: break-word;">${mdbdocument.title}</h1>
                                        <p style="color: white;">By ${name.data}</p>
                                    </div>
                                </a>
                            `

                            const holder = document.getElementById('frontboxholder')
                            holder.innerHTML += data
                        } else {
                            data = `
                                <a href="/articles/${mdbdocument.id}" style="order: 1;">
                                    <div class="frontbox">
                                        <h1 style="color: white;">${mdbdocument.title}</h1>
                                        <p style="color: white;">By ${name.data}</p>
                                    </div>
                                </a>
                            `
                            const holder = document.getElementById('bottomboxholder')
                            holder.innerHTML += data
                        }
                }
    
                fetch(url).then(response => {
                    return response.json()
                }).then(json => {
                    for (mdbdocument of json) {
                        loadArticle(mdbdocument)
                    }
                })
    
            });

            function postArticle() {
                window.location.href = "/articles/post?articleType=officialDoc"
            }
        </script>
    </head>

    <body>
        <!--Top Bar-->
        <div class="topnavsholder">
            <div class="topnav topnavholder">
                <a href="/">Tools</a>
                <a href="/articles/about">About</a>
                <a href="https://github.com/Ticko-Grey/trptools">Open Source</a>
            </div>

            <div class="topnav topnavholder nav-float" id="docsbuttonbar" style="flex-wrap: wrap;">
                <button class="inputbutton" style="background-color: #4CAF50;" onclick="postArticle()">Post Article</button>
            </div>

            <div class="topnav topnavholder nav-right">
                <a id="loginAccount" class="nav-full" href="/auth/login">Login</a>
            </div>
        </div>

        <div class="frontboxholder" id="frontboxholder">

        </div>

        <div class="frontboxholder" id="bottomboxholder">

        </div>
        
    </body>

    <script>
        function check() {
            if (loggedInUserSitePermissionLevel === null) { // basically repeat wait until 
                setTimeout(check, 50);
                return;
            }

            if (loggedInUserSitePermissionLevel <= 2) {
                document.getElementById('docsbuttonbar').remove();
            }
        }

        check()
    </script>
</html>